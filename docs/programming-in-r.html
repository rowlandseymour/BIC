<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Programming in R | Bayesian Inference and Computation</title>
  <meta name="description" content="This book contains the lecture notes for the module Bayesian Inference and Computation." />
  <meta name="generator" content="bookdown 0.28.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Programming in R | Bayesian Inference and Computation" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/uob_logo.png" />
  <meta property="og:description" content="This book contains the lecture notes for the module Bayesian Inference and Computation." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Programming in R | Bayesian Inference and Computation" />
  
  <meta name="twitter:description" content="This book contains the lecture notes for the module Bayesian Inference and Computation." />
  <meta name="twitter:image" content="/uob_logo.png" />

<meta name="author" content="Dr Rowland Seymour" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="fundamentals.html"/>
<link rel="next" href="bayesian-inference.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Bayesian Inference and Computation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Practicalities</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#module-aims"><i class="fa fa-check"></i><b>0.1</b> Module Aims</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#module-structure"><i class="fa fa-check"></i><b>0.2</b> Module Structure</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#assessment"><i class="fa fa-check"></i><b>0.3</b> Assessment</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#getting-help"><i class="fa fa-check"></i><b>0.4</b> Getting Help</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#recommended-books-and-videos"><i class="fa fa-check"></i><b>0.5</b> Recommended Books and Videos</a></li>
<li class="chapter" data-level="0.6" data-path="index.html"><a href="index.html#common-distributions"><i class="fa fa-check"></i><b>0.6</b> Common Distributions</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="fundamentals.html"><a href="fundamentals.html"><i class="fa fa-check"></i><b>1</b> Fundamentals of Bayesian Inference</a>
<ul>
<li class="chapter" data-level="1.1" data-path="fundamentals.html"><a href="fundamentals.html#statistical-inference"><i class="fa fa-check"></i><b>1.1</b> Statistical Inference</a></li>
<li class="chapter" data-level="1.2" data-path="fundamentals.html"><a href="fundamentals.html#frequentist-theory"><i class="fa fa-check"></i><b>1.2</b> Frequentist Theory</a></li>
<li class="chapter" data-level="1.3" data-path="fundamentals.html"><a href="fundamentals.html#bayesian-probability"><i class="fa fa-check"></i><b>1.3</b> Bayesian Probability</a></li>
<li class="chapter" data-level="1.4" data-path="fundamentals.html"><a href="fundamentals.html#conditional-probability-and-exchangability"><i class="fa fa-check"></i><b>1.4</b> Conditional Probability and Exchangability</a></li>
<li class="chapter" data-level="1.5" data-path="fundamentals.html"><a href="fundamentals.html#bayes-theorem"><i class="fa fa-check"></i><b>1.5</b> Bayes’ Theorem</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-in-r.html"><a href="programming-in-r.html"><i class="fa fa-check"></i><b>2</b> Programming in R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-in-r.html"><a href="programming-in-r.html#random-numbers-for-loops-and-r"><i class="fa fa-check"></i><b>2.1</b> Random Numbers, For Loops and R</a></li>
<li class="chapter" data-level="2.2" data-path="programming-in-r.html"><a href="programming-in-r.html#functions-in-r"><i class="fa fa-check"></i><b>2.2</b> Functions in R</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-in-r.html"><a href="programming-in-r.html#built-in-commands"><i class="fa fa-check"></i><b>2.2.1</b> Built in commands</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-in-r.html"><a href="programming-in-r.html#user-defined-functions"><i class="fa fa-check"></i><b>2.2.2</b> User defined functions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-in-r.html"><a href="programming-in-r.html#good-coding-practices"><i class="fa fa-check"></i><b>2.3</b> Good Coding Practices</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="programming-in-r.html"><a href="programming-in-r.html#code-style"><i class="fa fa-check"></i><b>2.3.1</b> Code Style</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayesian-inference.html"><a href="bayesian-inference.html"><i class="fa fa-check"></i><b>3</b> Bayesian Inference</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayesian-inference.html"><a href="bayesian-inference.html#the-binomial-distribution"><i class="fa fa-check"></i><b>3.1</b> The Binomial Distribution</a></li>
<li class="chapter" data-level="3.2" data-path="bayesian-inference.html"><a href="bayesian-inference.html#reporting-conclusions-from-bayesian-inference"><i class="fa fa-check"></i><b>3.2</b> Reporting Conclusions from Bayesian Inference</a></li>
<li class="chapter" data-level="3.3" data-path="bayesian-inference.html"><a href="bayesian-inference.html#the-exponential-distribution"><i class="fa fa-check"></i><b>3.3</b> The Exponential Distribution</a></li>
<li class="chapter" data-level="3.4" data-path="bayesian-inference.html"><a href="bayesian-inference.html#the-normal-distribtuion"><i class="fa fa-check"></i><b>3.4</b> The Normal Distribtuion</a></li>
<li class="chapter" data-level="3.5" data-path="bayesian-inference.html"><a href="bayesian-inference.html#hierarchical-models"><i class="fa fa-check"></i><b>3.5</b> Hierarchical Models</a></li>
<li class="chapter" data-level="3.6" data-path="bayesian-inference.html"><a href="bayesian-inference.html#prediction"><i class="fa fa-check"></i><b>3.6</b> Prediction</a></li>
<li class="chapter" data-level="3.7" data-path="bayesian-inference.html"><a href="bayesian-inference.html#non-informative-prior-distibrutions"><i class="fa fa-check"></i><b>3.7</b> Non-informative Prior Distibrutions</a></li>
<li class="chapter" data-level="3.8" data-path="bayesian-inference.html"><a href="bayesian-inference.html#bernstein-von-mises-theorem"><i class="fa fa-check"></i><b>3.8</b> Bernstein-von-Mises Theorem</a></li>
<li class="chapter" data-level="3.9" data-path="bayesian-inference.html"><a href="bayesian-inference.html#lab"><i class="fa fa-check"></i><b>3.9</b> Lab</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sampling.html"><a href="sampling.html"><i class="fa fa-check"></i><b>4</b> Sampling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sampling.html"><a href="sampling.html#uniform-random-numbers"><i class="fa fa-check"></i><b>4.1</b> Uniform Random Numbers</a></li>
<li class="chapter" data-level="4.2" data-path="sampling.html"><a href="sampling.html#inverse-transform-sampling"><i class="fa fa-check"></i><b>4.2</b> Inverse Transform Sampling</a></li>
<li class="chapter" data-level="4.3" data-path="sampling.html"><a href="sampling.html#rejection-sampling"><i class="fa fa-check"></i><b>4.3</b> Rejection Sampling</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="sampling.html"><a href="sampling.html#rejection-sampling-efficiency"><i class="fa fa-check"></i><b>4.3.1</b> Rejection Sampling Efficiency</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="sampling.html"><a href="sampling.html#ziggurat-sampling"><i class="fa fa-check"></i><b>4.4</b> Ziggurat Sampling</a></li>
<li class="chapter" data-level="4.5" data-path="sampling.html"><a href="sampling.html#lab-1"><i class="fa fa-check"></i><b>4.5</b> Lab</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>5</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#properties-of-markov-chains"><i class="fa fa-check"></i><b>5.1</b> Properties of Markov Chains</a></li>
<li class="chapter" data-level="5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-hastings"><i class="fa fa-check"></i><b>5.2</b> Metropolis-Hastings</a></li>
<li class="chapter" data-level="5.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#beyond-mcmc"><i class="fa fa-check"></i><b>5.6</b> Beyond MCMC</a></li>
<li class="chapter" data-level="5.7" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#lab-2"><i class="fa fa-check"></i><b>5.7</b> Lab</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="advanced-computation.html"><a href="advanced-computation.html"><i class="fa fa-check"></i><b>6</b> Advanced Computation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="advanced-computation.html"><a href="advanced-computation.html#gaussian-processes"><i class="fa fa-check"></i><b>6.1</b> Gaussian Processes</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="advanced-computation.html"><a href="advanced-computation.html#covariance-functions"><i class="fa fa-check"></i><b>6.1.1</b> Covariance Functions</a></li>
<li class="chapter" data-level="6.1.2" data-path="advanced-computation.html"><a href="advanced-computation.html#gaussian-process-regression"><i class="fa fa-check"></i><b>6.1.2</b> Gaussian Process Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="advanced-computation.html"><a href="advanced-computation.html#data-augmentation"><i class="fa fa-check"></i><b>6.2</b> Data Augmentation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="advanced-computation.html"><a href="advanced-computation.html#imputing-censored-observations"><i class="fa fa-check"></i><b>6.2.1</b> Imputing censored observations</a></li>
<li class="chapter" data-level="6.2.2" data-path="advanced-computation.html"><a href="advanced-computation.html#imputing-latent-variables"><i class="fa fa-check"></i><b>6.2.2</b> Imputing Latent Variables</a></li>
<li class="chapter" data-level="6.2.3" data-path="advanced-computation.html"><a href="advanced-computation.html#grouped-data"><i class="fa fa-check"></i><b>6.2.3</b> Grouped Data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="advanced-computation.html"><a href="advanced-computation.html#approximate-bayesian-computation"><i class="fa fa-check"></i><b>6.3</b> Approximate Bayesian Computation</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="advanced-computation.html"><a href="advanced-computation.html#abc-with-rejection"><i class="fa fa-check"></i><b>6.3.1</b> ABC with Rejection</a></li>
<li class="chapter" data-level="6.3.2" data-path="advanced-computation.html"><a href="advanced-computation.html#summary-abc-with-rejection"><i class="fa fa-check"></i><b>6.3.2</b> Summary ABC with Rejection</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="advanced-computation.html"><a href="advanced-computation.html#prior-ellicitation"><i class="fa fa-check"></i><b>6.4</b> Prior Ellicitation</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="advanced-computation.html"><a href="advanced-computation.html#prior-summaries"><i class="fa fa-check"></i><b>6.4.1</b> Prior Summaries</a></li>
<li class="chapter" data-level="6.4.2" data-path="advanced-computation.html"><a href="advanced-computation.html#betting-with-histograms"><i class="fa fa-check"></i><b>6.4.2</b> Betting with Histograms</a></li>
<li class="chapter" data-level="6.4.3" data-path="advanced-computation.html"><a href="advanced-computation.html#prior-intervals"><i class="fa fa-check"></i><b>6.4.3</b> Prior Intervals</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="advanced-computation.html"><a href="advanced-computation.html#lab-3"><i class="fa fa-check"></i><b>6.5</b> Lab</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="advanced-computation.html"><a href="advanced-computation.html#gaussian-processes-1"><i class="fa fa-check"></i><b>6.5.1</b> Gaussian Processes</a></li>
<li class="chapter" data-level="6.5.2" data-path="advanced-computation.html"><a href="advanced-computation.html#missing-data"><i class="fa fa-check"></i><b>6.5.2</b> Missing Data</a></li>
<li class="chapter" data-level="6.5.3" data-path="advanced-computation.html"><a href="advanced-computation.html#approximate-bayesian-computation-1"><i class="fa fa-check"></i><b>6.5.3</b> Approximate Bayesian Computation</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Inference and Computation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="programming-in-r" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Programming in R<a href="programming-in-r.html#programming-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="random-numbers-for-loops-and-r" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Random Numbers, For Loops and R<a href="programming-in-r.html#random-numbers-for-loops-and-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This first computer lab is about getting used to R. The first step is to download R and Rstudio.</p>
<ul>
<li><a href="https://www.r-project.org">Download R</a></li>
<li><a href="https://posit.co/downloads/">Download RStudio IDE</a></li>
</ul>
<p>The easiest way to learn R is by using it to solve problems. The lab contains four exercises and three ways of approaching the exercise (easy, medium and hard). If you’re new to R, use the easy approach and copy and paste the code straight into R – you’ll need to fill in a few blanks though. If you’ve used R before, or a similar programming language, stick to the medium and hard approaches. This is also an exercise in using Google. Googling around a problem of for specific commands can allow you to quickly find examples (most likely on Stack Overflow) with code you can use.</p>
<p>There are three aims of this lab:</p>
<ol style="list-style-type: decimal">
<li>Getting used to programming in R.</li>
<li>Generating random numbers in R.</li>
<li><a href="https://www.w3schools.com/r/r_for_loop.asp">Creating for loops in R</a>.</li>
</ol>
<div class="example">
<p><span id="exm:unlabeled-div-19" class="example"><strong>Example 2.1  </strong></span>Computationally verify that the Poisson distribution with rate <span class="math inline">\(\lambda = 100\)</span> can be approximated by a normal distribution with mean and variance 100.</p>
<p>To do this, we can generate lots of samples from a Poisson(100) distribution and plot them on top of the density function of the normal distribution with mean and variance 100.</p>
<p>R has four built-in functions for working with distributions. They take the form <code>rdist</code>, <code>ddist</code>, <code>pdist</code>, and <code>qdist</code>. You replace the <code>dist</code> part with the name of the distribution you want to work with, for example <code>unif</code> for the uniform distribution or <code>norm</code> for the normal distribution. As we are working with the the Poisson distribution, we will use <code>pois</code>. The prefixes allow you to work with the distribution in different ways: <code>r</code> gives you random numbers sampled form the distribution, <code>d</code> evaluates the density function, <code>p</code> evaluates the density function, and <code>q</code> evaluates the inverse density function (or quantile function).</p>
<p>The function <code>rpois</code> allows us to generate samples from a Poisson distribution. We store 10,000 samples in a vector <code>y</code> by calling</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="programming-in-r.html#cb2-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">10000</span>, <span class="at">lambda =</span> <span class="dv">100</span>)</span></code></pre></div>
<p>We can generate a histogram of <code>y</code> using the <code>hist</code> command. Setting <code>freq = FALSE</code>, makes R plot a density histogram instead of a frequency histogram. Typing <code>?hist</code> will give you more information about this</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="programming-in-r.html#cb3-1" tabindex="-1"></a><span class="fu">hist</span>(y, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">&quot;y&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The last thing to do is to plot the normal density on top. There are a couple of ways of doing this. The way below generates a uniform grid of points and then evaluates the density at each point. Finally, it adds a line graph of these densities on top.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="programming-in-r.html#cb4-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">50</span>, <span class="at">to =</span> <span class="dv">150</span>, <span class="at">by =</span> <span class="dv">1</span>)           <span class="co">#create uniform grid on [50, 150]</span></span>
<span id="cb4-2"><a href="programming-in-r.html#cb4-2" tabindex="-1"></a>density <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">100</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">100</span>)) <span class="co">#compute density</span></span>
<span id="cb4-3"><a href="programming-in-r.html#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="programming-in-r.html#cb4-4" tabindex="-1"></a><span class="co">#plot together</span></span>
<span id="cb4-5"><a href="programming-in-r.html#cb4-5" tabindex="-1"></a><span class="fu">hist</span>(y, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">&quot;y&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb4-6"><a href="programming-in-r.html#cb4-6" tabindex="-1"></a><span class="fu">lines</span>(x, density)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>The two match up well, showing the normal distribution is a suitable approximation here.</p>
</div>
<p>Over the next two sessions, you will need to solve the following four problems in R. You can type <code>?</code> before any function in R (e.g. <code>?rnorm</code>) to bring up R’s helpage on the function. Googling can also bring up lots of information, possible solutions and support.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-20" class="exercise"><strong>Exercise 2.1  </strong></span>The changes in the Birmingham stock exchange each day can be modelled using a normal distribution. The price on day <span class="math inline">\(i\)</span>, <span class="math inline">\(X_i\)</span> is given by
<span class="math display">\[
X_i = \alpha X_{i-1}, \qquad \alpha \sim N(1.001, 0.005^2).
\]</span>
The index begins at <span class="math inline">\(X_0 = 100\)</span>. Investigate the distribution of the value of the stock market on days 50 and 100.</p>
<p><strong>Hard</strong>. Use a simulation method to generate the relevant distributions.</p>
<p><strong>Medium</strong>. Simulate the value for <span class="math inline">\(\alpha\)</span> for each of the 100 days and use the <code>cumprod</code> command to plot a trajectory. Use a for loop to repeat this 100 times and investigate the distribution of the value of the stock market on days 50 and 100.</p>
<p><strong>Easy</strong>. Fill in the blanks in the following code.</p>
<pre><code># Plot one ----------------------------------------------------------------
x &lt;- rnorm(n = , mean = , sd = ) #Simulate daily change for 100 days
plot(, type = &#39;l&#39;) #multiply each day by the previous days

# Plot 100 realisations ---------------------------------------------------
market.index &lt;- matrix(NA, 100, 100) #Initialise a matrix to store trajectories
for(i in 1:100){
  x &lt;- rnorm(n = , mean = , sd = )
  market.index [, i] &lt;- 
}

#Plot all trajectories
matplot(market.index, type = &#39;l&#39;)

#Get distribution of days 50 and 100
hist()
hist()
quantile(, )
quantile(, )</code></pre>
</div>
<div class="exercise">
<p><span id="exr:unlabeled-div-21" class="exercise"><strong>Exercise 2.2  </strong></span>You are an avid lottery player and play the lottery twice a week, every week for 50 years (a total of 5,200 times). The lottery has 50 balls labeled 1, …, 50 and you play the same 6 numbers each time. Six out of the 50 balls are chosen uniformly at random and the prize money is shown in the table below.</p>
<table>
<thead>
<tr class="header">
<th>Numbers Matched</th>
<th>Prize Amount</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0-2</td>
<td>£0</td>
</tr>
<tr class="even">
<td>3</td>
<td>£30</td>
</tr>
<tr class="odd">
<td>4</td>
<td>£140</td>
</tr>
<tr class="even">
<td>5</td>
<td>£1,750</td>
</tr>
<tr class="odd">
<td>6</td>
<td>£1,000,000</td>
</tr>
</tbody>
</table>
<p>It costs you £2 to play each time. Simulate one set of 5,200 draws. How much do you win? What is your total profit/loss?</p>
<p><strong>Hard</strong>. Use a for loop and sequence of if else statements to generate your prize winnings.</p>
<p><strong>Medium</strong>. Use a for loop to generate the lottery numbers and prize winnings for each draw. Use the <code>sample</code> function to generate a set of lottery numbers and check they match against your numbers using the <code>%in%</code> function. Finally, use if else statements to check how much you have won each time.</p>
<p><strong>Easy</strong>. Fill in the blanks in the following code.</p>
<pre><code>my.numbers &lt;- 

#For loop to generate lottery numbers and prize winnings
prize &lt;- numeric(5200)
for(i in 1:5200){
  
  #Generate lottery numbers
  draw &lt;- sample(, )
  
  #Check how many match my numbers
  numbers.matched &lt;- #use %in% function
  
  #Compute prize winings
  if(numbers.matched &lt; 3)
    prize[i] &lt;- 0
  else if()
    prize[i] &lt;-  30
  else if()
    prize[i] &lt;-  140
  else if()
    prize[i] &lt;-  1750
  else
    prize[i] &lt;- 1000000
}

#Summarise prize winnings
table(prize)
hist(prize)
sum(prize) - 2*5200</code></pre>
</div>
<div class="exercise">
<p><span id="exr:unlabeled-div-22" class="exercise"><strong>Exercise 2.3  </strong></span>Estimate <span class="math inline">\(\pi\)</span>.</p>
<p><strong>Hard</strong>. Use a rejection sampling algorithm.</p>
<p><strong>Medium</strong>. Generate lots of points <span class="math inline">\((x, y)\)</span> on the unit square <span class="math inline">\([0, 1]^2\)</span>. Check each point to see if it lies within the unit circle. Use the proportion of points that lie within the unit circle to estimate <span class="math inline">\(\pi\)</span>.</p>
<p><strong>Easy</strong>. Fill in the blanks in the following code.</p>
<pre><code>#Sample on unit square
N &lt;- 10000      #number of points
x &lt;-            #sample N points uniformly at random on [0, 1]
y &lt;-            #sample N points uniformly at random on [0, 1]

#Estimate pi
r.sq                 &lt;- x^2 + y^2                #check how far from origin
number.inside.circle &lt;-           #count how many points inside unit cirlce
pi.estimate          &lt;- 

#Plot points
par(pty = &quot;s&quot;)         #make sure plot is square
plot(x, y, cex = 0.1)  #plot points
theta &lt;- seq(0, pi/2, 0.01) #plot unit circle
lines(x = cos(theta), y = sin(theta), col = &quot;red&quot;)</code></pre>
<p><strong>Extra</strong>. Use a for loop to repeat this for <span class="math inline">\(N = \{1, \ldots, 10000\}\)</span>. Record the estimate for <span class="math inline">\(\pi\)</span> for each value and the relative error.</p>
</div>
<div class="exercise">
<p><span id="exr:unlabeled-div-23" class="exercise"><strong>Exercise 2.4  </strong></span>A linear congruential generator (LCG) is a simple algorithm for generating random integers. Given a starting value <span class="math inline">\(X_0\)</span>, it generates a sequence of integers according to
<span class="math display">\[
X_{i+1} = a X_i + c \mod m.
\]</span>
Software that generates numbers using an LCG Setting <span class="math inline">\(a = 3\)</span>, <span class="math inline">\(c = 2\)</span>, <span class="math inline">\(m = 7\)</span> and <span class="math inline">\(X_0 = 0\)</span>, generate 20 samples from this generator.</p>
<ol style="list-style-type: decimal">
<li><p>Investigate the ‘randomness’ of this generator by creating the delay plot, where <span class="math inline">\(X_{i-1}\)</span> is plotted against <span class="math inline">\(X_{i}\)</span></p></li>
<li><p>One way to improve the quality of these generators is to shuffle the sequence generated. Generate rate two sequences <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> from two different LCGs, and report the shuffled sequence <span class="math inline">\(Z_j = X_{Y_j}\)</span>. For the sequence <span class="math inline">\(Y\)</span> use the values <span class="math inline">\(a = 5\)</span>, <span class="math inline">\(c = 1\)</span>, <span class="math inline">\(m = 8\)</span> and <span class="math inline">\(Y_0 = 2\)</span>.</p></li>
<li><p>As the past two exercises show, LCGs are notoriously poor. in the 1960s and 70s, RANDU was a widely used LCG developed by IBM. According to Wikipedia
&gt; IBM’s RANDU is widely considered to be one of the most ill-conceived random number generators ever designed, and was described as “truly horrible” by Donald Knuth.</p></li>
</ol>
<p>The RANDU LCG uses <span class="math inline">\(a = 2^{16} + 3\)</span>, <span class="math inline">\(c = 0\)</span>, <span class="math inline">\(m = 2^{31}\)</span> and <span class="math inline">\(Y_0 = 1\)</span>. Generate a sequence of 10,000 pseudorandom variables from the RANDU LCG and create the delay plot.</p>
<p>The delay plot seems to show little relationship between <span class="math inline">\(X_{i}\)</span> and <span class="math inline">\(X_{i+1}\)</span>. The third order delay plot is a 3d-plot with coordinate <span class="math inline">\((X_i, X_{i+1}, X_{i+2})\)</span> and this plot shows a different picture. Create this plot using the code</p>
<pre><code>#install.packages(&quot;scatterplot3d&quot;) #you may need to install this package
scatterplot3d::scatterplot3d(X[1:9998], X[2:9999], X[3:10000], angle=154, 
                             xlab = expression(X[i]), ylab = expression(X[i+1]), zlab = expression(X[i+2]))</code></pre>
<p>This is what makes the RANDU LCG so poor. Write down <span class="math inline">\(X_{i+1}\)</span> and <span class="math inline">\(X_{i+2}\)</span> in terms of <span class="math inline">\(X_i\)</span>. Show that <span class="math inline">\(X_{i+2} = \alpha X_{i+1} + \beta X_{i}\)</span>.</p>
<p><strong>Hard</strong>. Use a for loop to construct sequences from the LCGs <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<p><strong>Medium</strong>. Create a for loop to generate the value for the sequence <span class="math inline">\(X_i\)</span> for <span class="math inline">\(i = 1, \ldots, 20\)</span>. Modular arithmetic can be performed using the <code>%%</code> function. Create a new for loop to construct the sequence <span class="math inline">\(Y\)</span>. To shuffle the sequence <span class="math inline">\(X\)</span> using <span class="math inline">\(Y\)</span>, you will need to subset <span class="math inline">\(X\)</span> by <span class="math inline">\(Y\)</span> in R.</p>
<p><strong>Easy</strong>. Fill in the blanks in the code below</p>
<pre><code># 1. Shuffling ---------------------------------------------------------------
X &lt;- numeric(21) #initialise vector to store X

#Set values for LCG
a &lt;- 
c &lt;- 
m &lt;- 
X[1]&lt;- 


#Run Generator
for(i in 2:21){
  X[i] &lt;-
}
X

#Delay plot
plot( , , xlab = expression(X[i-1]), ylab = expression(X[i]), type = &#39;l&#39;)



# 2. Shuffling ---------------------------------------------------------------

Y &lt;- numeric(21) #initialise vector to store Y

#Set values for LCG
a &lt;- 
c &lt;- 
m &lt;- 
Y[1]&lt;- 


#Run Generator
for(i in 2:50){
  Y[i] &lt;- 
}

#report sequence
Y
X[Y]

#Plot delay plot
plot(x = ,y = , xlab = expression(Z[i-1]), ylab = expression(Z[i]), type = &#39;l&#39;)
</code></pre>
</div>
</div>
<div id="functions-in-r" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Functions in R<a href="programming-in-r.html#functions-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The purpose of this lab is to learn how to write functions is R. Functions are wrappers that allow you to easily repeat commands, as well as customise specific pieces of code.</p>
<div id="built-in-commands" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Built in commands<a href="programming-in-r.html#built-in-commands" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R has many build in commands and you used these in Computer Lab I. An example is the <code>runif</code> command from the second exercise. This function generates random numbers from an interval. The code chunk below shows it in action:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="programming-in-r.html#cb10-1" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">10</span>, <span class="at">min =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb10-2"><a href="programming-in-r.html#cb10-2" tabindex="-1"></a>u</span></code></pre></div>
<pre><code>##  [1] -0.1380692 -0.7814054 -0.6685599  0.6182115 -0.4346018  0.4188106
##  [7]  0.7069304 -0.3426697 -0.6814300  0.5904823</code></pre>
<p>The functions has three <strong>arguments</strong>: <em>n</em> the number of samples to be generated, <em>min</em> the lower limit of the interval, <em>max</em> the upper limit of the interval. In the code chunk above 10 random numbers were generated from the interval [-1, 1]. In R, you don’t need to label the arguments, so the following will sample the same number of samples from the same interval:</p>
<pre><code>u &lt;- runif(10, -1, 1)</code></pre>
<p>Although in most cases it helps to label the arguments for readability and avoiding undefined behaviour. Note that if you decide to omit the argument names in the function call, the arguments must appear exactly in the order defined by the function prototype (check the documentation ?function for specific cases).</p>
</div>
<div id="user-defined-functions" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> User defined functions<a href="programming-in-r.html#user-defined-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In many cases, we will need to repeat the same piece of code over and over again, or we will need to run it again with different values. In this case, we can write our own function. In R, there are two ways to type your own function. The first is to write a full function definition. The basic template is</p>
<pre><code>name.of.function &lt;- function(arguments){

  #do something
  #produce result
  
  return(result)

}</code></pre>
<p>The second way is an in-line function, which is sometimes useful for short functions. The template is</p>
<pre><code>name.of.function &lt;- function(arguments) #do something</code></pre>
<p>In this module, we’re going to use the full function way of writing functions.</p>
<div class="example">
<p><span id="exm:unlabeled-div-24" class="example"><strong>Example 2.2  </strong></span>In this example, we’re going to write a function to evaluate the normal density function. The density function is given by
<span class="math display">\[
\pi(x \mid \mu, \sigma^2) = \frac{1}{\sqrt{2\pi\sigma^2}}e^{\left\{-\frac{1}{2\sigma^2}(x-\mu)^2\right\}}.
\]</span></p>
<p>We will need our function to take three arguments, the value at which the density function needs to be evaluated, and the mean and standard deviation of the distribution.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="programming-in-r.html#cb15-1" tabindex="-1"></a>normal.density <span class="ot">&lt;-</span> <span class="cf">function</span>(x, mu, sigma){</span>
<span id="cb15-2"><a href="programming-in-r.html#cb15-2" tabindex="-1"></a>  </span>
<span id="cb15-3"><a href="programming-in-r.html#cb15-3" tabindex="-1"></a>  fraction.term <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb15-4"><a href="programming-in-r.html#cb15-4" tabindex="-1"></a>  exponent.term <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>(x<span class="sc">-</span>mu)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb15-5"><a href="programming-in-r.html#cb15-5" tabindex="-1"></a>  </span>
<span id="cb15-6"><a href="programming-in-r.html#cb15-6" tabindex="-1"></a>  result <span class="ot">&lt;-</span> fraction.term<span class="sc">*</span><span class="fu">exp</span>(exponent.term)</span>
<span id="cb15-7"><a href="programming-in-r.html#cb15-7" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb15-8"><a href="programming-in-r.html#cb15-8" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="programming-in-r.html#cb15-9" tabindex="-1"></a>}</span></code></pre></div>
<p>We have split up the density into two parts to make it easier to code up and read. R has its own inbuilt normal density function <code>dnorm</code> and we can compare our function against R’s. Although R’s is faster and more reliable, we should get the same results.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="programming-in-r.html#cb16-1" tabindex="-1"></a><span class="fu">normal.density</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">mu =</span> <span class="dv">1</span>, <span class="at">sigma =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 0.4839414</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="programming-in-r.html#cb18-1" tabindex="-1"></a><span class="fu">dnorm</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 0.4839414</code></pre>
<p>Why might R’s function be faster and more reliable than ours?</p>
</div>
<div class="exercise">
<p><span id="exr:unlabeled-div-25" class="exercise"><strong>Exercise 2.5  </strong></span>Write a function to evaluate the log of the probability density function of a Poisson distribution with rate <span class="math inline">\(\lambda\)</span>.</p>
</div>
<div class="exercise">
<p><span id="exr:unlabeled-div-26" class="exercise"><strong>Exercise 2.6  </strong></span>Consider the stock exchange problem in Exercise 2.1. Write a function that simulates 100 days of the stock exchange. Use the <code>replicate</code> function to call this function 10,000 times.</p>
</div>
</div>
</div>
<div id="good-coding-practices" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Good Coding Practices<a href="programming-in-r.html#good-coding-practices" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the past two labs, we’ve written code to solve different problems. In this lab, we’re going to take a step back and think about what good R code does and doesn’t look like.</p>
<div id="code-style" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Code Style<a href="programming-in-r.html#code-style" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Code should be both efficient and easy to read. In most cases it’s better to write code that’s easy to read and less efficient, than highly efficient code that’s difficult to read. Some basic principles to make code easy to read are:</p>
<ol style="list-style-type: decimal">
<li>Write short functions names, e.g. <code>buy.loot.box</code> is better than <code>player.buys.one.loot.boox</code> or <code>blb</code>.</li>
<li>Document and comment code. In R comments start with <code>#</code>.</li>
<li>Multiple short functions are better than long functions that do multiple things.</li>
<li>Be consistent.</li>
</ol>
<div class="example">
<p><span id="exm:unlabeled-div-27" class="example"><strong>Example 2.3  </strong></span>Review the <a href="https://style.tidyverse.org/index.html">tidyverse Style Guide</a>.</p>
</div>
<div class="example">
<p><span id="exm:unlabeled-div-28" class="example"><strong>Example 2.4  </strong></span>Review <a href="https://google.github.io/styleguide/Rguide.html">Google’s R Style Guide</a>.</p>
</div>
<p>One way to ensure code style is consistent and bug free is to carry out code reviews. These are common both in academia and industry. A code review is where someone else goes through your code line-by-line ensuring it conforms to the company style and doesn’t have any bugs.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-29" class="exercise"><strong>Exercise 2.7  </strong></span>The following code is for Exercises 2.1 about the stock exchange. Restyle the code so it is easy to read.</p>
<pre><code># Plot one ----------------------------------------------------------------
rnorm(100,1.001,0.5) -&gt; x 
plot(100*cumprod(x),type =&#39;l&#39;) 
# Plot 100 realisations ---------------------------------------------------
X &lt;- matrix(NA, 100, 100) 
for(i in 1:100){
  x &lt;- rnorm(100, 1.001, 0.005)
  X[,i] &lt;- 100*cumprod(x)
}
matplot(X,type =&#39;l&#39;)
hist(X[50,]);hist(X[100,]);quantile(X[50,], c(0.25, 0.5, 0.75));quantile(X[100,], c(0.25, 0.5, 0.75))</code></pre>
</div>
<div class="exercise">
<p><span id="exr:unlabeled-div-30" class="exercise"><strong>Exercise 2.8  </strong></span>In pairs or groups, carry out a code review for one of your solutions to an exercise from a previous lab. Remember to</p>
<ol style="list-style-type: decimal">
<li>Make sure the coding style is consistent.</li>
<li>Identify any bugs.</li>
<li>Be respectful and constructive in your feedback.</li>
</ol>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fundamentals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian-inference.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
